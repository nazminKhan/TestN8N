name: Flutter Analyze Reporter

on:
  push:
    branches:
      - main

permissions:
  contents: write  # âœ… Required to allow pushing code back

jobs:
  analyze:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Install Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.32.7'

      - name: Run Flutter Analyze
        run: |
          flutter analyze > flutter-report.txt || true
          echo "==== FLUTTER ANALYSIS COMPLETE ===="
          cat flutter-report.txt

      - name: Commit flutter-report.txt
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --global user.email "github-bot@appaspect.com"
          git config --global user.name "GitHub Bot"
          git remote set-url origin https://x-access-token:${GITHUB_TOKEN}@github.com/${{ github.repository }}
          git add flutter-report.txt
          git commit -m "Update flutter analysis report" || echo "No changes to commit"
          git push



# name: Flutter Analyze & Report

# on:
#   push:
#     branches:
#       - main  # change if your branch is different

# jobs:
#   analyze:
#     runs-on: ubuntu-latest

#     steps:
#       - name: Checkout Code
#         uses: actions/checkout@v3

#       - name: Setup Flutter
#         uses: subosito/flutter-action@v2
#         with:
#           flutter-version: '3.32.7'  # adjust as needed

#       - name: Debug Flutter Setup
#         run: flutter doctor -v

#       - name: Install Dependencies
#         run: flutter pub get

#       - name: Run flutter analyze
#         run: flutter analyze > flutter-report.txt || true

#       - name: Send Report to n8n Webhook
#         run: |
#           curl -X POST https://n8n-automation-secure.appaspect.com/webhook/flutter-analyze \
#           -H "Content-Type: text/plain" \
#           --data-binary @flutter-report.txt
